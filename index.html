<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Room Expense Tracker</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{
  --bg-start:#6dd5fa;--bg-end:#2980b9;
  --card-bg:#ffffffdd;--accent:#007bff;--highlight:#28a745;
  --remove:#e74c3c;--text:#222;
  --header-light:#fff; --row-light:#f9f9f9;
}

body{
  margin:0;
  padding:20px;
  font-family:"Poppins",sans-serif;
  color:var(--text);
  background:linear-gradient(270deg,var(--bg-start),var(--bg-end));
  background-size:400% 400%;
  animation:gradShift 15s ease infinite;
}
@keyframes gradShift{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}

.container{
  max-width:600px;
  margin:auto;
  background:var(--card-bg);
  border-radius:15px;
  padding:20px;
  box-shadow:0 8px 20px rgba(0,0,0,0.25);
}
h2{text-align:center;margin:0 0 10px 0;}
input,select,button{
  padding:10px;
  margin:5px 0;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:16px;
  width:100%;
  box-sizing:border-box;
  background:var(--card-bg);
  color:var(--text);
}
button{
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:6px;
  transition:all 0.2s;
}
button:hover{transform:scale(1.05);}
button.remove-btn{background:var(--remove);color:#fff;border:none;}
button.split-btn{background:var(--accent);color:#fff;border:none;}
button.report-btn{background:var(--highlight);color:#fff;border:none;}

.table-wrap{overflow-x:auto;margin-top:10px;}
table{width:100%;border-collapse:separate;border-spacing:0 6px;}
thead th{padding:8px;border-radius:6px;background-color:var(--accent);color:var(--header-light);}
tbody td{padding:8px;text-align:center;border-radius:6px;font-size:14px;}
tfoot td{font-weight:bold;border-radius:6px;padding:8px;text-align:center;}
tbody tr:nth-child(odd){background-color:var(--row-light);}

/* Members styling */
.member-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 12px;
  margin:6px 0;
  border-radius:8px;
  background: rgba(0,0,0,0.05);
  box-sizing:border-box;
  font-size:14px;
}
.member-item button{
  background: var(--remove);
  color: #fff;
  border: none;
  border-radius: 50%;
  width:28px;
  height:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  cursor:pointer;
  flex-shrink:0;
}

/* Quick Add Button */
#quickAddBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  background:var(--highlight);
  color:#fff;
  border:none;
  width:60px;
  height:60px;
  border-radius:50%;
  font-size:30px;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
  z-index:10;
}

/* Modals */
.modal{
  display:none;
  position:fixed;
  z-index:100;
  left:0;
  top:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.6);
  justify-content:center;
  align-items:center;
}
.modal-content{
  background:var(--card-bg);
  padding:20px;
  border-radius:10px;
  width:95%;
  max-width:400px;
  color:var(--text);
  max-height:90%;
  overflow-y:auto;
  box-shadow:0 4px 15px rgba(0,0,0,0.3);
  position:relative;
}

/* Close Button */
.close-btn {
  position: absolute;
  top:10px;
  right:10px;
  background: var(--remove);
  border: none;
  border-radius: 50%;
  width:30px;
  height:30px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  color:#fff;
  font-size:16px;
  z-index:10;
  transition: transform 0.2s, background 0.2s;
}
.close-btn:hover {
  transform: scale(1.2);
  background:#c0392b;
}

/* Split checkboxes styling */
.checkbox-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 8px;
  margin: 10px 0;
}
.checkbox-grid input[type="checkbox"] {
  display: none;
}
.checkbox-grid label {
  display: flex;
  justify-content:center;
  align-items: center;
  cursor: pointer;
}
.checkbox-grid span {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 50px;
  background: rgba(0,0,0,0.05);
  color: var(--text);
  font-size: 14px;
  text-align: center;
  transition: all 0.25s ease;
  min-width: 60px;
  position: relative;
}
.checkbox-grid input[type="checkbox"]:checked + span {
  background: var(--highlight);
  color: #fff;
  box-shadow: 0 3px 8px rgba(0,0,0,0.2);
  transform: scale(1.05);
}
.checkbox-grid input[type="checkbox"]:checked + span::after {
  content: "‚úî";
  position: absolute;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 12px;
  opacity: 0.9;
}

/* Tabs */
.tab-btns{
  display:flex;
  gap:8px;
  margin-bottom:8px;
  justify-content:center;
  flex-wrap:wrap;
}
.tab-btns button{flex:1;}

@media(max-width:400px){
  button,input,select{font-size:14px;padding:8px;}
  .checkbox-grid span {font-size:13px;padding:4px 8px; min-width:50px;}
  .member-item {padding:6px 8px;}
  .member-item button {width:24px;height:24px;font-size:14px;}
}
</style>
</head>
<body>

<div class="container">
<h2>üè† Room Expense Tracker</h2>
<input type="number" id="rent" placeholder="Total Room Rent (AED)">
<div style="display:flex;flex-wrap:wrap;gap:6px;margin:10px 0;">
<button onclick="openMemberEditor()"><i class="fas fa-users"></i> Members</button>
<button onclick="openAddExpenseModal()" class="split-btn"><i class="fas fa-plus"></i> Add Expense</button>
<button onclick="openReportModal()" class="report-btn"><i class="fas fa-chart-pie"></i> Reports</button>
<button onclick="resetValues()" class="remove-btn"><i class="fas fa-redo"></i> Clear</button>
</div>
<div class="table-wrap">
<table id="expenseTable">
<thead><tr><th>Payer</th><th>Amount</th><th>Shared Amount</th><th>Shared With</th><th>Action</th></tr></thead>
<tbody></tbody>
<tfoot></tfoot>
</table>
</div>
</div>

<button id="quickAddBtn" onclick="openAddExpenseModal()"><i class="fas fa-plus"></i></button>

<!-- Add Expense Modal -->
<div class="modal" id="expenseModal">
<div class="modal-content">
<button class="close-btn" onclick="closeAddExpenseModal()"><i class="fas fa-times"></i></button>
<h3>‚ûï Add Expense</h3>
<select id="expensePayer"></select>
<input type="number" id="expenseAmount" placeholder="Amount">
<div>
<h4>Split with:</h4>
<div class="checkbox-grid" id="expenseSplit"></div>
</div>
<button onclick="submitExpense()" class="split-btn" style="margin-top:10px;"><i class="fas fa-check"></i> Add Expense</button>
</div>
</div>

<!-- Members Modal -->
<div class="modal" id="memberModal">
<div class="modal-content">
<button class="close-btn" onclick="closeMemberEditor()"><i class="fas fa-times"></i></button>
<h3>üë• Edit Members</h3>
<div id="memberList"></div>
<input type="text" id="newMemberName" placeholder="Add new member">
<div style="display:flex;gap:6px;margin-top:6px;">
<button onclick="addMember()" class="split-btn"><i class="fas fa-plus"></i> Add</button>
<button onclick="saveMemberChanges()" class="report-btn"><i class="fas fa-check"></i> Done</button>
</div>
</div>
</div>
<!-- Reports Modal -->
<div class="modal" id="reportModal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeReportModal()"><i class="fas fa-times"></i></button>
    <h3>üìä Reports</h3>
    <div class="tab-btns">
      <button onclick="generateExpenseReport()" class="split-btn"><i class="fas fa-list"></i> Expense Report</button>
      <button onclick="generateToPayReport()" class="report-btn"><i class="fas fa-hand-holding-usd"></i> To Pay Report</button>
    </div>
    <div class="table-wrap">
      <table id="reportTable"><thead></thead><tbody></tbody></table>
    </div>
    <div style="display:flex;gap:6px;margin-top:6px;flex-wrap:wrap;">
      <button onclick="downloadReportPDF()" class="report-btn"><i class="fas fa-file-pdf"></i> PDF</button>
      <button onclick="shareReportWhatsApp()" class="report-btn"><i class="fab fa-whatsapp"></i> WhatsApp</button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
let people = ["RAMSHAD","ASHIR","ZAKKI","ASEEF","KUTTAPI"];
let expenses = [];
let currentReportType = 'expense';

// Members UI
function updateMemberUI() {
  const list = document.getElementById('memberList');
  list.innerHTML = '';
  people.forEach(p => {
    const div = document.createElement('div');
    div.className = 'member-item';
    div.innerHTML = `<span>${p}</span><button onclick="removeMember('${p}')">√ó</button>`;
    list.appendChild(div);
  });
}
function addMember() {
  const name = document.getElementById('newMemberName').value.trim().toUpperCase();
  if (!name || people.includes(name)) return;
  people.push(name);
  document.getElementById('newMemberName').value = '';
  updateUI(); saveData();
}
function removeMember(name) {
  people = people.filter(p => p !== name);
  updateUI(); saveData();
}
function saveMemberChanges() { closeMemberEditor(); saveData(); }
function openMemberEditor() { document.getElementById('memberModal').style.display = 'flex'; updateMemberUI(); }
function closeMemberEditor() { document.getElementById('memberModal').style.display = 'none'; }

// Expense Modal
function openAddExpenseModal() {
  document.getElementById('expenseModal').style.display = 'flex';
  const sel = document.getElementById('expensePayer');
  sel.innerHTML = people.map(p => `<option>${p}</option>`).join('');
  const split = document.getElementById('expenseSplit');
  split.innerHTML = '';
  people.forEach(p => {
    const id = 'chk_'+p;
    split.innerHTML += `<label><input type="checkbox" id="${id}" value="${p}" checked><span>${p}</span></label>`;
  });
  document.getElementById('expenseAmount').value = '';
}
function closeAddExpenseModal() { document.getElementById('expenseModal').style.display = 'none'; }
function submitExpense() {
  const payer = document.getElementById('expensePayer').value;
  const amount = parseFloat(document.getElementById('expenseAmount').value) || 0;
  if (!amount) return alert('Enter amount');
  const shared = [...document.querySelectorAll('#expenseSplit input:checked')].map(c => c.value);
  if (shared.length === 0) return alert('Select at least one member');
  expenses.push({ payer, amount, shared });
  updateExpenseTable(); closeAddExpenseModal(); saveData();
}

// Expense Table
function updateExpenseTable() {
  const tbody = document.querySelector('#expenseTable tbody');
  tbody.innerHTML = '';
  expenses.forEach((e, idx) => {
    const row = document.createElement('tr');
    const perShare = (e.amount / e.shared.length).toFixed(2);
    row.innerHTML = `<td>${e.payer}</td><td>${e.amount.toFixed(2)}</td><td>${perShare}</td><td>${e.shared.join(', ')}</td><td><button onclick="removeExpense(${idx})" class="remove-btn">√ó</button></td>`;
    tbody.appendChild(row);
  });
}
function removeExpense(idx) { expenses.splice(idx,1); updateExpenseTable(); saveData(); }

// Reports
function openReportModal() { document.getElementById('reportModal').style.display = 'flex'; generateExpenseReport(); }
function closeReportModal() { document.getElementById('reportModal').style.display = 'none'; }
function generateExpenseReport() { currentReportType='expense'; renderReport(); }
function generateToPayReport() { currentReportType='toPay'; renderReport(); }
function renderReport() {
  const rent = parseFloat(document.getElementById('rent').value) || 0;
  const paid = {}, owe = {};
  people.forEach(p => { paid[p]=0; owe[p]=0; });
  expenses.forEach(e => {
    const per = (e.amount / e.shared.length);
    e.shared.forEach(p => owe[p] += per);
    paid[e.payer] += e.amount;
  });
  const rentShare = rent / people.length;
  const table = document.getElementById('reportTable');
  table.innerHTML = '';
  if(currentReportType==='expense'){
    let thead='<tr><th>Payer</th><th>Amount</th><th>Shared Amount</th><th>Shared With</th></tr>';
    let tbody='';
    expenses.forEach(e=>{
      const per=(e.amount/e.shared.length).toFixed(2);
      tbody+=`<tr><td>${e.payer}</td><td>${e.amount.toFixed(2)}</td><td>${per}</td><td>${e.shared.join(', ')}</td></tr>`;
    });
    table.innerHTML=`<thead>${thead}</thead><tbody>${tbody}</tbody>`;
  } else {
    let thead='<tr><th>Name</th><th>Paid</th><th>Expenses</th><th>Rent</th><th>To Pay</th></tr>';
    let tbody='';
    people.forEach(p=>{
      const toPay=(rentShare+owe[p]-paid[p]).toFixed(2);
      tbody+=`<tr><td>${p}</td><td>${paid[p].toFixed(2)}</td><td>${owe[p].toFixed(2)}</td><td>${rentShare.toFixed(2)}</td><td>${toPay}</td></tr>`;
    });
    table.innerHTML=`<thead>${thead}</thead><tbody>${tbody}</tbody>`;
  }
}

// Reports Export / Share
function downloadReportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("üè† Room Expense Tracker",10,10);
  doc.text("Generated: "+new Date().toLocaleString(),10,16);
  doc.autoTable({startY:26, html:"#reportTable"});
  doc.save("Room_Expense_Tracker.pdf");
}
function shareReportWhatsApp() {
  let text="üè† Room Expense Tracker Report\n\n";
  document.querySelectorAll("#reportTable tbody tr").forEach(tr=>{
    text+=Array.from(tr.children).map(td=>td.textContent).join(" | ")+"\n";
  });
  text+="Generated on: "+new Date().toLocaleString();
  window.open("https://wa.me/?text="+encodeURIComponent(text),"_blank");
}

// Reset
function resetValues() {
  if(!confirm('Clear all data?')) return;
  document.getElementById('rent').value='';
  expenses=[];
  updateExpenseTable();
  saveData();
}

// Update UI & LocalStorage
function updateUI() { updateExpenseTable(); updateMemberUI(); }
function saveData() { localStorage.setItem('roomExpenseData',JSON.stringify({people,expenses,rent:document.getElementById('rent').value})); }
function loadData() {
  const data=JSON.parse(localStorage.getItem('roomExpenseData')||'{}');
  if(data.people) people=data.people;
  if(data.expenses) expenses=data.expenses;
  if(data.rent) document.getElementById('rent').value=data.rent;
  updateUI();
}
window.addEventListener('DOMContentLoaded',loadData);
window.addEventListener('beforeunload',saveData);
</script>
</body>
</html>
